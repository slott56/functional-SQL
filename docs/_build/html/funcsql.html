<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>funcsql Code &#8212; Functional SQL  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Demonstration Code" href="demo.html" />
    <link rel="prev" title="Components" href="components.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="funcsql-code">
<span id="funcsql"></span><h1>funcsql Code<a class="headerlink" href="#funcsql-code" title="Link to this heading">¶</a></h1>
<p>Here’s the content of the <code class="xref py py-mod docutils literal notranslate"><span class="pre">funcsql</span></code> module.</p>
<p class="plantuml">
<img src="_images/plantuml-2f2caba00e2f932a6d1e8d98fb225aa27b68ed05.png" alt="&#64;startuml

package funcsql {

    class Table
    class Row

    Table *- Row : produces

    class QueryComposite

    QueryComposite *-- Row

    class Select {
        from_()
        where()
        join()
        group_by()
        having()
    }

    class Aggregate
    class SelectStar
    class lambda &lt;&lt; (F,orchid) &gt;&gt;

    Select o-- Aggregate
    Select - SelectStar
    Select o-- lambda

    class fetch &lt;&lt; (F,orchid) &gt;&gt;

    fetch --- Select : executes
    fetch o--&gt; Row : &gt; produces
    fetch o-- Table : &lt; consumes
    fetch o-- QueryComposite : uses

}"/>
</p>
<p>We’ll look at the <a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Table</span></code></a> and <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> structures first.
Then the <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a> class, used to define a query.</p>
<p>The <a class="reference internal" href="#funcsql.fetch" title="funcsql.fetch"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.fetch()</span></code></a> function embodies the <strong>Essential SQL Algorithm</strong>.
It executes the query object, consuming rows from tables and producing rows in a result.
Along the way, it builds <a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.QueryComposite</span></code></a> objects which are provided to lambdas to evaluate expressions.</p>
<section id="table-and-row">
<h2>Table and Row<a class="headerlink" href="#table-and-row" title="Link to this heading">¶</a></h2>
<p>The <a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Table</span></code></a> objects contain the data to be processed.
The <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> is a wrapper that provides handy attribute name access for dictionary keys.</p>
<section id="table">
<h3>Table<a class="headerlink" href="#table" title="Link to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="funcsql.Table">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">Table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funcsql.Table" title="Link to this definition">¶</a></dt>
<dd><p>The foundational collection of data consumed by a query.</p>
<p>A Table produces <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> objects, but doesn’t necessarily contain them.
The structure in this class is a <code class="docutils literal notranslate"><span class="pre">list[dict[str,</span> <span class="pre">Any]]</span></code>.
From these, <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> objects are created.</p>
<p>A table has an internal name that’s used by the query.
This should match the Python variable name, but that’s not a requirement.</p>
<p>The <strong>external</strong> Python variable is only used in the <a class="reference internal" href="#funcsql.Select.from_" title="funcsql.Select.from_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">funcsql.Select.from_()</span></code></a> method.
The <strong>internal</strong> string name is used in all lambdas throughout the query.</p>
<p>Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="s1">&#39;row1-colum1&#39;</span><span class="p">,</span> <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="s1">&#39;row2-colum1&#39;</span><span class="p">,</span> <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="mi">43</span><span class="p">},</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">[Row(&#39;t&#39;, **{&#39;col1&#39;: &#39;row1-colum1&#39;, &#39;col2&#39;: 42}), Row(&#39;t&#39;, **{&#39;col1&#39;: &#39;row2-colum1&#39;, &#39;col2&#39;: 43})]</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Table names <strong>must</strong> be valid Python identifiers.</p>
<p>Column names <strong>must</strong> be valid Python identifiers.</p>
</div>
<p>The data source for a table can can be raw (external) data or
it could be  results of query execution.</p>
<p>Subclasses can support a wide variety of collections.</p>
<ul class="simple">
<li><p>list[list[str]] supplied with a schema (i.e. CSV reader + headers).</p></li>
<li><p>list[JSONDoc] with JSONSchema schema definition from NDJSON files.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Table.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#funcsql.Table.load" title="Link to this definition">¶</a></dt>
<dd><p>Replace the underlying data with this data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Table.column_names">
<span class="sig-name descname"><span class="pre">column_names</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.Table.column_names" title="Link to this definition">¶</a></dt>
<dd><p>Expose the column names. Useful for <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span></code> constructs.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Table.alias_iter">
<span class="sig-name descname"><span class="pre">alias_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.Table.alias_iter" title="Link to this definition">¶</a></dt>
<dd><p>Apply a table alias.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Table.from_rows">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_rows</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rows</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><span class="pre">Table</span></a></span></span><a class="headerlink" href="#funcsql.Table.from_rows" title="Link to this definition">¶</a></dt>
<dd><p>Builds a table from a sequence of rows – possibly a UNION of multiple queries.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Table.from_query">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><span class="pre">Select</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><span class="pre">Table</span></a></span></span><a class="headerlink" href="#funcsql.Table.from_query" title="Link to this definition">¶</a></dt>
<dd><p>Builds a table by fetching the results of the given query.</p>
</dd></dl>

</dd></dl>

</section>
<section id="row">
<h3>Row<a class="headerlink" href="#row" title="Link to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="funcsql.Row">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">Row</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funcsql.Row" title="Link to this definition">¶</a></dt>
<dd><p>An immutable collection of column names and values.</p>
<p>Subclasses can be created to wrap a variety of collections,
including dataclasses or Pydantic <code class="docutils literal notranslate"><span class="pre">base_model</span></code> instances.</p>
<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Row._asdict">
<span class="sig-name descname"><span class="pre">_asdict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.Row._asdict" title="Link to this definition">¶</a></dt>
<dd><p>Return the row as a dictionary.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Row._values">
<span class="sig-name descname"><span class="pre">_values</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.Row._values" title="Link to this definition">¶</a></dt>
<dd><p>Rerturn only the values from this row.</p>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="select-query-builder">
<h2>Select query builder<a class="headerlink" href="#select-query-builder" title="Link to this heading">¶</a></h2>
<p>The <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a> class is used by build queries (and subqueries.)
It’s used by the <a class="reference internal" href="#funcsql.fetch" title="funcsql.fetch"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.fetch()</span></code></a> function (among others) to consume rules from <a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Table</span></code></a> objects
and produce an iterable sequence of <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> results.</p>
<p>The result of a <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a> construction is a data structure to be used by the <a class="reference internal" href="#funcsql.fetch" title="funcsql.fetch"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.fetch()</span></code></a> function.
A <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a> is iterable as a convenience.</p>
<section id="select">
<h3>Select<a class="headerlink" href="#select" title="Link to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="funcsql.Select">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">Select</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">star_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.SelectStar" title="funcsql.SelectStar"><span class="pre">SelectStar</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">name_expr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#funcsql.Aggregate" title="funcsql.Aggregate"><span class="pre">Aggregate</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funcsql.Select" title="Link to this definition">¶</a></dt>
<dd><p>Creates the query, starting with the  SELECT clause.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span></code> queries, the <code class="docutils literal notranslate"><span class="pre">star</span></code> parameter must be <code class="docutils literal notranslate"><span class="pre">STAR</span></code>.</p>
<p>For all other query forms, use <code class="docutils literal notranslate"><span class="pre">name=lambda</span> <span class="pre">qc:</span> <span class="pre">expr</span></code> constructs.
This is equivalent to <code class="docutils literal notranslate"><span class="pre">expr</span> <span class="pre">AS</span> <span class="pre">name</span></code> in SQL.</p>
<p>The expression can contain <code class="docutils literal notranslate"><span class="pre">table.column</span></code> references using <code class="docutils literal notranslate"><span class="pre">qc.table.column</span></code>.
The full name must be provided: we don’t attempt to deduce the
table that belongs with a name.</p>
<p>The expression can contain any other Python literal of function.</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">answer</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">literal</span>
<span class="k">FROM</span><span class="w"> </span><span class="k">table</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">Select</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span><span class="n">qc</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
    <span class="n">answer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">qc</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">literal</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="mi">42</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Each expression must be a function (or lambda or callable object) that accepts
a single <a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.QueryComposite</span></code></a> object and returns a useful value.</p>
<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Select.from_">
<span class="sig-name descname"><span class="pre">from_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">tables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><span class="pre">Table</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">named_tables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><span class="pre">Table</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#funcsql.Select.from_" title="Link to this definition">¶</a></dt>
<dd><p>The FROM clause: the tables to query.
Table aliases aren’t required if all the table names are unique.</p>
<p>To do a self-Join, the tables require an alias.
The alias will be used in QueryComposite objects.</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">manager</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">m</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">...</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">Select</span><span class="p">(</span>
        <span class="n">employee</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="n">qc</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">manager</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="n">qc</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">name</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">from_</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">employees</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">employees</span><span class="p">)</span>
    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This method also expands <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span></code> into proper names.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Select.join">
<span class="sig-name descname"><span class="pre">join</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><span class="pre">Table</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">on_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">alias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><span class="pre">Table</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#funcsql.Select.join" title="Link to this definition">¶</a></dt>
<dd><p>The JOIN table ON condition clause: a table to query and the join condition for that table.</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">manager</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">e</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">employee_id</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">Select</span><span class="p">(</span>
        <span class="n">employee</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="n">qc</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">manager</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="n">qc</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">name</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">from_</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">employees</span><span class="p">)</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">employee</span><span class="p">,</span> <span class="n">on_</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="n">qc</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">manager_id</span> <span class="o">==</span> <span class="n">qc</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">employee_id</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In principle, this <strong>could</strong> lead to an optimization where pair-wise table joins are done
to build the final <code class="docutils literal notranslate"><span class="pre">QueryComposite</span></code> objects.</p>
<p>This doesn’t handle any of the outer join operators.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Select.where">
<span class="sig-name descname"><span class="pre">where</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">function</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#funcsql.Select.where" title="Link to this definition">¶</a></dt>
<dd><p>The WHERE clause: an expression used for joining and filtering.</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">manager</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">m</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">employee_id</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">Select</span><span class="p">(</span>
        <span class="n">employee</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="n">qc</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">manager</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="n">qc</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">name</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">from_</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">employees</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">employees</span><span class="p">)</span>
    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="n">qc</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">manager_id</span> <span class="o">==</span> <span class="n">qc</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">employee_id</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Select.group_by">
<span class="sig-name descname"><span class="pre">group_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">named_expr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#funcsql.Select.group_by" title="Link to this definition">¶</a></dt>
<dd><p>The GROUP BY clause: a list of names or a list of name=expr expressions.</p>
<p>If names are provided, they <em>must</em> be names computed by the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> clause.</p>
<p>If name=expr is used, the name=expr is added to the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> clause.</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">deparment_id</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employees</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">department_id</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">Select</span><span class="p">(</span>
        <span class="n">department_id</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="n">qc</span><span class="o">.</span><span class="n">employees</span><span class="o">.</span><span class="n">department_id</span>
        <span class="n">count</span><span class="o">=</span><span class="n">Aggregate</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">from_</span><span class="p">(</span><span class="n">employees</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s2">&quot;department_id&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funcsql.Select.having">
<span class="sig-name descname"><span class="pre">having</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">function</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#funcsql.Select.having" title="Link to this definition">¶</a></dt>
<dd><p>The HAVING clause: an expression to filter groups.</p>
<p>The expression will operate on <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> objects.
It does <strong>not</strong> operate on <code class="docutils literal notranslate"><span class="pre">QueryComposite</span></code> objects.</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">deparment_id</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employees</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">department_id</span>
<span class="k">HAVING</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">Select</span><span class="p">(</span>
        <span class="n">department_id</span><span class="o">=</span><span class="k">lambda</span> <span class="n">qc</span><span class="p">:</span> <span class="n">qc</span><span class="o">.</span><span class="n">employees</span><span class="o">.</span><span class="n">department_id</span>
        <span class="n">count</span><span class="o">=</span><span class="n">Aggregate</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">from_</span><span class="p">(</span><span class="n">employees</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s2">&quot;department_id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">having</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The groups are not built from <code class="docutils literal notranslate"><span class="pre">QueryComposite</span></code> objects; they’re simpler <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> objects.</p>
</dd></dl>

</dd></dl>

</section>
<section id="selectstar">
<h3>SelectStar<a class="headerlink" href="#selectstar" title="Link to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="funcsql.SelectStar">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">SelectStar</span></span><a class="headerlink" href="#funcsql.SelectStar" title="Link to this definition">¶</a></dt>
<dd><p>A way to handle <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span></code>.
This is provided <strong>instead</strong> of any <code class="docutils literal notranslate"><span class="pre">name=expr</span></code> parameters to <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a>.</p>
<p>This reaches into the from clause and join clause tables and extracts the schema information.</p>
<p>In the event of duplicate column names in a multi-table join, the last one will be used.</p>
</dd></dl>

<p>There’s one instance of this class, called <code class="docutils literal notranslate"><span class="pre">STAR</span></code>.</p>
</section>
<section id="aggregate">
<h3>Aggregate<a class="headerlink" href="#aggregate" title="Link to this heading">¶</a></h3>
<p>Aggregate comptuations are done <strong>after</strong> grouping, and must be delayed until then.
To make this work out, they’re wrapped as an object that’s distinct from a simple <code class="docutils literal notranslate"><span class="pre">lambda</span></code>.</p>
<dl class="py class">
<dt class="sig sig-object py" id="funcsql.Aggregate">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">Aggregate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reduction_function</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funcsql.Aggregate" title="Link to this definition">¶</a></dt>
<dd><p>Wrapper for an aggregate function to summarize.</p>
<p>There are three forms for using this:</p>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m_x</span> <span class="o">=</span> <span class="n">Aggregate</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">jr</span><span class="p">:</span> <span class="n">jr</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">column</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">x=expr</span></code> defines the raw value to summarize.
This value is then referred to by name in the <code class="docutils literal notranslate"><span class="pre">Aggregate()</span></code> constructor.
(Yes, the <code class="docutils literal notranslate"><span class="pre">x=</span></code> is defined later, but name resolution doesn’t happen until the query is run.)</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m_x</span> <span class="o">=</span> <span class="n">Aggregate</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">jr</span><span class="p">:</span> <span class="n">jr</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>
</pre></div>
</div>
<p>Same as above. A column name is made up for the expression.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="n">Aggregate</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A special case.</p>
</li>
</ul>
<p>Many SQL aggregates are first-class parts of Python.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>AVG</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">statistics.mean()</span></code></p></td>
</tr>
<tr class="row-even"><td><p>COUNT</p></td>
<td><p>We define a special <code class="xref py py-func docutils literal notranslate"><span class="pre">functsql.count()</span></code> function to ignore None.</p></td>
</tr>
<tr class="row-odd"><td><p>MAX</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">max()</span></code></p></td>
</tr>
<tr class="row-even"><td><p>MIN</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">min()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>SUM</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">sum()</span></code></p></td>
</tr>
<tr class="row-even"><td><p>STDEV</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">statistics.stdev()</span></code></p></td>
</tr>
</tbody>
</table>
</dd></dl>

</section>
<section id="querycomposite">
<h3>QueryComposite<a class="headerlink" href="#querycomposite" title="Link to this heading">¶</a></h3>
<p>These objects move through the <a class="reference internal" href="#funcsql.fetch" title="funcsql.fetch"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.fetch()</span></code></a> function’s pipeline of steps.</p>
<dl class="py class">
<dt class="sig sig-object py" id="funcsql.QueryComposite">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">QueryComposite</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">table_rows</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funcsql.QueryComposite" title="Link to this definition">¶</a></dt>
<dd><p>A collection of <code class="docutils literal notranslate"><span class="pre">Row</span></code> instances from one or more named Tables.
This provides attribute navigation through the columns of the tables in this composite.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QueryComposite</span><span class="p">(</span><span class="n">Row</span><span class="p">(</span><span class="s2">&quot;t1&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">t1</span><span class="o">.</span><span class="n">a</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">b</span>
<span class="go">2</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="sql-algorithm">
<h2>SQL Algorithm<a class="headerlink" href="#sql-algorithm" title="Link to this heading">¶</a></h2>
<section id="fetch">
<h3>fetch<a class="headerlink" href="#fetch" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="funcsql.fetch">
<span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">fetch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><span class="pre">Select</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.fetch" title="Link to this definition">¶</a></dt>
<dd><p>The essential SQL algorithm.</p>
<div class="math notranslate nohighlight">
\[Q(T) = H \biggl( G \Bigl( S \left( W ( F(T) ) \right) \Bigr) \biggr)\]</div>
<p>Where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(H\)</span> is <a class="reference internal" href="#funcsql.from_product" title="funcsql.from_product"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.from_product()</span></code></a>.</p></li>
<li><p><span class="math notranslate nohighlight">\(G\)</span> is <a class="reference internal" href="#funcsql.group_reduce" title="funcsql.group_reduce"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.group_reduce()</span></code></a>, which uses <a class="reference internal" href="#funcsql.aggregate_map" title="funcsql.aggregate_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.aggregate_map()</span></code></a></p></li>
<li><p><span class="math notranslate nohighlight">\(S\)</span> is <a class="reference internal" href="#funcsql.select_map" title="funcsql.select_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.select_map()</span></code></a>.</p></li>
<li><p><span class="math notranslate nohighlight">\(W\)</span> is <a class="reference internal" href="#funcsql.where_filter" title="funcsql.where_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.where_filter()</span></code></a>.</p></li>
<li><p><span class="math notranslate nohighlight">\(F\)</span> is <a class="reference internal" href="#funcsql.from_product" title="funcsql.from_product"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.from_product()</span></code></a>.</p></li>
</ul>
<p>Inverting these function, the order of operations is:</p>
<ol class="arabic simple">
<li><p>FROM – Creates table-like creature with <code class="docutils literal notranslate"><span class="pre">QueryComposite</span></code> rows.</p></li>
<li><p>WHERE – filters <code class="docutils literal notranslate"><span class="pre">QueryComposite</span></code> rows.</p></li>
<li><p>SELECT – creates a <code class="docutils literal notranslate"><span class="pre">Table</span></code> with simple <code class="docutils literal notranslate"><span class="pre">Row</span></code> instances, but no name.</p></li>
<li><p>GROUP BY – creates a second table with <code class="docutils literal notranslate"><span class="pre">Row</span></code> instances and no name.</p></li>
<li><p>HAVING – filters the second table</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> – The Query that provides Row instances.</p></li>
<li><p><strong>context</strong> – A context used for subqueries that depend on a context query.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Row instances.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="funcsql.exists">
<span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><span class="pre">Select</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#funcsql.exists" title="Link to this definition">¶</a></dt>
<dd><p>Did a suquery fetch any rows?
Implements the <code class="docutils literal notranslate"><span class="pre">EXISTS()</span></code> function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>context</strong> – A context used for subqueries that depend on a context query.</p></li>
<li><p><strong>query</strong> – The Query that provides Row instances.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if any row was built by the query.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The order of the arguments is reversed from <a class="reference internal" href="#funcsql.fetch" title="funcsql.fetch"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.fetch()</span></code></a> because
this is used in a query builder where a context is generally required.</p>
</div>
</dd></dl>

</section>
<section id="fetch-values">
<h3>fetch values<a class="headerlink" href="#fetch-values" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="funcsql.fetch_first_value">
<span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">fetch_first_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><span class="pre">Select</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#funcsql.fetch_first_value" title="Link to this definition">¶</a></dt>
<dd><p>Fetches the first row’s first column value.
Implements cases where subquery produces a scalar value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="funcsql.fetch_all_values">
<span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">fetch_all_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><span class="pre">Select</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.fetch_all_values" title="Link to this definition">¶</a></dt>
<dd><p>Fetches the all row’s first column values.
Implements cases where subquery produces a set of values.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">col</span> <span class="pre">IN</span> <span class="pre">(SELECT</span> <span class="pre">...)</span></code>.</p>
</dd></dl>

</section>
<section id="component-functions">
<h3>component functions<a class="headerlink" href="#component-functions" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="funcsql.from_product">
<span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">from_product</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><span class="pre">Select</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.from_product" title="Link to this definition">¶</a></dt>
<dd><p>FROM clause creates an iterable of <a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.QueryComposite</span></code></a> objects as a product of source tables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> – The <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a> object</p></li>
<li><p><strong>context</strong> – An optional context used for subqueries.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>product of all rows of all tables</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="funcsql.where_filter">
<span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">where_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><span class="pre">Select</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">composites</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.where_filter" title="Link to this definition">¶</a></dt>
<dd><p>WHERE clause filters the iterable <a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.QueryComposite</span></code></a> objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> – The <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a> object</p></li>
<li><p><strong>composites</strong> – An iterable source of <a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.QueryComposite</span></code></a> objects</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An iterator overn <a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.QueryComposite</span></code></a> objects.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="funcsql.select_map">
<span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">select_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><span class="pre">Select</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">composites</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><span class="pre">QueryComposite</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.select_map" title="Link to this definition">¶</a></dt>
<dd><p>SELECT clause applies all non-aggregate computations to the <a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.QueryComposite</span></code></a> objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> – The <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a> object</p></li>
<li><p><strong>composites</strong> – An iterable source of <a class="reference internal" href="#funcsql.QueryComposite" title="funcsql.QueryComposite"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.QueryComposite</span></code></a> objects</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an iterator over <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> instances.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="funcsql.aggregate_map">
<span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">aggregate_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">select_clause_agg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#funcsql.Aggregate" title="funcsql.Aggregate"><span class="pre">Aggregate</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groups</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.aggregate_map" title="Link to this definition">¶</a></dt>
<dd><p>Applies <code class="docutils literal notranslate"><span class="pre">Aggregate</span></code> computations to grouped rows.</p>
<p>Very similar to the way the <a class="reference internal" href="#funcsql.select_map" title="funcsql.select_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.select_map()</span></code></a> function works.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>select_clause_agg</strong> – the aggregate functions from a <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a> object</p></li>
<li><p><strong>groups</strong> – the key: list[value] mapping with groups built from raw data.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an iterator over <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> instances.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="funcsql.group_reduce">
<span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">group_reduce</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><span class="pre">Select</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">select_rows</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.group_reduce" title="Link to this definition">¶</a></dt>
<dd><p>GROUP BY clause either creates groups and summaries, or passes data through.</p>
<p>There are three cases:</p>
<ul class="simple">
<li><p>Group by with no aggregate functions. This will be a collection of group keys.</p></li>
<li><p>Aggregate functions with no Group by. This is a single summary aggregate applied to all data.
Think <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">COUNT(*)</span> <span class="pre">FROM</span> <span class="pre">table</span></code>.</p></li>
<li><p>Neither Group by nor aggregate functions. The data passes through.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> – The <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a> object</p></li>
<li><p><strong>select_rows</strong> – iterable sequence of  <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> objects</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>iterator over  <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> objects</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="funcsql.having_filter">
<span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">having_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><span class="pre">Select</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">group_rows</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funcsql.having_filter" title="Link to this definition">¶</a></dt>
<dd><p>HAVING clause filters the groups.</p>
<p>This is similar to <a class="reference internal" href="#funcsql.where_filter" title="funcsql.where_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">funcsql.where_filter()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> – The <a class="reference internal" href="#funcsql.Select" title="funcsql.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Select</span></code></a> object</p></li>
<li><p><strong>select_rows</strong> – iterable sequence of  <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> objects</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>iterator over  <a class="reference internal" href="#funcsql.Row" title="funcsql.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Row</span></code></a> objects</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="other-sql">
<h2>Other SQL<a class="headerlink" href="#other-sql" title="Link to this heading">¶</a></h2>
<p>These perform the expected operation on the underlying <a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Table</span></code></a>.
It’s often better to reach into the <code class="docutils literal notranslate"><span class="pre">Table</span></code> directly.
The point of the <a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">funcsql.Table</span></code></a> class is to wrap an underlying Python data structure.</p>
<dl class="py class">
<dt class="sig sig-object py" id="funcsql.Insert">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">Insert</span></span><a class="headerlink" href="#funcsql.Insert" title="Link to this definition">¶</a></dt>
<dd><p>Adds rows to a Table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Insert</span><span class="p">()</span><span class="o">.</span><span class="n">into</span><span class="p">(</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">([{</span><span class="n">data</span><span class="p">}])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funcsql.Update">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">Update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funcsql.Table" title="funcsql.Table"><span class="pre">Table</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funcsql.Update" title="Link to this definition">¶</a></dt>
<dd><p>Updates rows in a Table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">Update</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">function</span><span class="p">)</span>
    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">condition</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funcsql.Delete">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funcsql.</span></span><span class="sig-name descname"><span class="pre">Delete</span></span><a class="headerlink" href="#funcsql.Delete" title="Link to this definition">¶</a></dt>
<dd><p>Deletes rows from a table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Delete</span><span class="p">()</span><span class="o">.</span><span class="n">from_</span><span class="p">(</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">condition</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Functional SQL</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="concept.html">Concept</a></li>
<li class="toctree-l1"><a class="reference internal" href="components.html">Components</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">funcsql Code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#table-and-row">Table and Row</a></li>
<li class="toctree-l2"><a class="reference internal" href="#select-query-builder">Select query builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sql-algorithm">SQL Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-sql">Other SQL</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="demo.html">Demonstration Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes.html">Notes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="components.html" title="previous chapter">Components</a></li>
      <li>Next: <a href="demo.html" title="next chapter">Demonstration Code</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, S.Lott.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/funcsql.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>